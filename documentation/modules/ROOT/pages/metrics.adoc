= Metrics

[.console-input]
[source,bash]
----
./mvnw quarkus:add-extension -Dextension=quarkus-smallrye-metrics
----

[.console-output]
[source,text]
----
[INFO] Scanning for projects...
[INFO]
[INFO] -----------------< com.redhat.developers:tutorial-app >-----------------
[INFO] Building tutorial-app 1.0-SNAPSHOT
[INFO] --------------------------------[ jar ]---------------------------------
[INFO]
[INFO] --- quarkus-maven-plugin:1.4.2.Final:add-extension (default-cli) @ tutorial-app ---
âœ… Adding extension io.quarkus:quarkus-smallrye-metrics
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  1.128 s
[INFO] Finished at: 2020-05-11T22:44:28-04:00
[INFO] ------------------------------------------------------------------------
----

[.console-input]
[source,java]
----
package com.redhat.developers;

import java.time.Instant;
import java.util.Calendar;
import java.util.TimeZone;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

import org.eclipse.microprofile.metrics.annotation.Counted;
import org.eclipse.microprofile.metrics.annotation.Gauge;


@Path("/time")
public class TimeResource {
    
    @Counted(name = "time.now")
    @GET
    @Produces(MediaType.TEXT_PLAIN)
    public Instant now() {
        return Instant.now();
    }

    @Gauge(name = "offsetFromUTC", unit = "hours")
    public int offsetFromUTC() {
        return TimeZone.getDefault().getOffset(Calendar.ZONE_OFFSET)/(3600*1000);
    }

}
----

[.console-input]
[source,bash]
----
for i in {1..5}; do curl localhost:8080/time; done
----

[.console-output]
[source,bash]
----
2020-05-12T22:38:10.546500Z
2020-05-12T22:38:10.869378Z
2020-05-12T22:38:11.188782Z
2020-05-12T22:38:11.510367Z
2020-05-12T22:38:11.832583Z
----

[.console-input]
[source,bash]
----
curl -H "Accept: application/json" localhost:8080/metrics/application
----

[.console-output]
[source,json]
----
{
    "com.redhat.developers.TimeResource.time.now": 5,
    "com.redhat.developers.TimeResource.offsetFromUTC": -5
}
----