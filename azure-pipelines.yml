trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- checkout: self
  persistCredentials: "true"

- task: InstallSSHKey@0
  inputs:
    knownHostsEntry: $(githubHostEntry)
    sshKeySecureFile: $(githubDeployKey)
    sshPublicKey: $(githubPublicKey)
  displayName: 'Setup Github Environment'

- task: NodeTool@0
  inputs:
    versionSpec: '10.x'
  displayName: 'Install Node.js'

- script: |
    npm install -g @antora/cli@2.0 -g @antora/site-generator-default@2.0 gh-pages@2.0.1
    git config --local user.email "kamesh.sampath@hotmail.com"
    git config --local user.name "Kamesh Sampath"
  displayName: 'Install Tools and Packages'

- script: |
    antora --pull --stacktrace site.yml
  displayName: 'Generate Site'

- script: |
    touch gh-pages/.nojekyll
    gh-pages --dotfiles --message "Publishing new documentation **NO_CI**" --dist gh-pages
  displayName: 'Deploy Site'
