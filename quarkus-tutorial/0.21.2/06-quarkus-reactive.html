<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reactive Programming :: Quarkus Tutorial</title>
    <link rel="canonical" href="https://redhat-developer-demos.github.io/quarkus-tutorial/quarkus-tutorial/0.21.2/06-quarkus-reactive.html">
    <meta name="generator" content="Antora 2.0.1">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://redhat-developer-demos.github.io/quarkus-tutorial">Quarkus Tutorial</a>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container"  data-component="quarkus-tutorial"
  data-version="0.21.2" >
  <aside class="navigation">
    <div class="panels">
      <div class="navigation-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">Quarkus Tutorial</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="01-setup.html">1. Setup</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#download-tutorial-sources">Download Tutorial Sources</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#kubernetes-cluster">Kubernetes Cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="01-setup.html#setup-work-folder">Work Folder</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="02-basics-fundas.html">2.Basics and Fundamentals</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basics-fundas.html#basics-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basics-fundas.html#basics-create-quarkus-app">Create Quarkus Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basics-fundas.html#basics-ide-quarkus-project">Open Application in IDE</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basics-fundas.html#basics-build-run-quarkus-app">Build and Run Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basics-fundas.html#basics-update-code">Update Code</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basics-fundas.html#basics-call-svc">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="02-basics-fundas.html#basics-testing">Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="02-basics-fundas.html#basics-logging">Configuring Logging</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02-basics-fundas.html#basics-call-svc-logging">Invoke Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="02-basics-fundas.html#basics-configuration">Configuration</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02-basics-fundas.html#basics-configuration-new-property">Add New Property</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02-basics-fundas.html#basics-configuration-get-value">Get Configuration Value</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="02-basics-fundas.html#basics-call-configuration">Invoke Service</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03-containers-kubernetes.html">3. Cloud Native Deployment</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-prerequisite">Prerequisites</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-build-container-app">Containerize Quarkus Application</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-call-svc">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-deploy-k8s-app">Deploy on Kubernetes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-deploy-k8s-app">Tag Container Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-k8s-apply-resources">Apply Kubernetes Resources</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-invoke-k8s-svc">Invoke Kubernetes Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="03-containers-kubernetes.html#conk8s-delete-k8s-app">Delete Kubernetes Resources</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-quarkus-extensions.html">4. Quarkus Extensions</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-intro">What are Extensions ?</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-list-extensions">List Extensions</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-quarkus-extensions.html#qext-rest-client">Rest Client</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-add-rest-client-extensions">Adding Rest Client extension</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-create-fruity-vice-pojo">Creating FruityVice POJO</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-create-fruity-vice-service">Creating FruityVice Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-create-fruity-vice-service-config">Configuring FruityVice Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-create-fruity-vice-service-resclient">Using the RestClient</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-rest-client-run-quarkus-app-dev-mode">Run Quarkus Application in Development mode</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-call-fruity-rest-client">Invoke Service</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-quarkus-extensions.html#qext-fault-tolerance">Fault Tolerance</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-add-fault-tolerance-extensions">Adding Fault Tolerance extension</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-retry-fruity-vice-service">Add Retry to Fruity Vice Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-fault-tolerance-run-quarkus-app-dev-mode">Run Quarkus Application in Development mode</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-call-fruity-fault-tolerance-retry">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-fallback-fruity-vice-service">Add Fallback to Fruity Vice Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-fault-tolerance-fallback-run-quarkus-app-dev-mode">Run Quarkus Application in Development mode</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-call-fruity-fault-tolerance-fallback">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-circuit-breaker-fruity-vice-service">Add Ciruict Breaker to Fruity Vice Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-circuit-breaker-run-quarkus-app-dev-mode">Run Quarkus Application in Development mode</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-call-fruity-fault-tolerance-circuit-breaker">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-turn-on-network">Turn Network On</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="04-quarkus-extensions.html#qext-health-checks">Health Checks</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-add-extensions">Add Extension</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-rebuild-container-images">Rebuild Container Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-check-health-endpoint">Check Health Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-call-health-ep">Invoke Health Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-add-probes-to-k8s">Add Health Probes to Kubernetes Application</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-invoke-k8s-svc">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-custom-health-check">Customizing Health Checks</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-rebuild-container-images-custom-check">Rebuild Container Images</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-check-custom-health-endpoint">Check Health Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-call-health-custom">Invoke Health Endpoint</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="04-quarkus-extensions.html#qext-add-custom-probes-to-k8s">Add Health Probes to Kubernetes Application</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-quarkus-panache.html">5. Hibernate with Quarkus</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-demo-overview">Demo Overview</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-fruitapp-dev">Build and Deploy</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkus-fruit-app-db">Deploy Mariadb</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-access-db">Access Database </a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkuspdb-update-props">Configure Application properties</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-create-fruit-entity">Create Fruit Entity</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-edit-fruit-resource">Update Fruit Resource</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-fruits-finder">Finders</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-testing">Testing</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-cloud-dev">Deploy on Kubernetes</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-cloud-dev-build-container">Build Containers</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-cloud-dev-prepare-app">Prepare Kubernetes Application</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-cloud-dev-apply-resources">Apply Resources</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-invoke-k8s-svc">Invoke Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="05-quarkus-panache.html#quarkusp-persistence-k8s-delete-resources">Delete Kubernetes Resource</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="06-quarkus-reactive.html">6. Reactive Programming with Quarkus</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-toggle"></button>
    <a class="nav-link" href="#quarkusrpb-demo-overview">Beer Demo Overview</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#quarkusrpb-buld-beer-reactive">Build Beer Service</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="#qext-reactive-beer-run-quarkus-app-dev-mode">Run Quarkus Application with Beer Service</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
    </div>
  </aside>
  <div class="navigation-explore" data-panel="explore">
  <div class="context">
    <!-- Just a place holder to fill in  explorer for each context -->
  </div>
</div>
</div>
  <main class="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
  <a href="index.html" class="home-link"></a>
  <nav class="crumbs" aria-label="breadcrumbs">
  <ul>
    <li class="crumb"><a href="index.html">Quarkus Tutorial</a></li>
    <li class="crumb"><a href="06-quarkus-reactive.html">6. Reactive Programming with Quarkus</a></li>
  </ul>
</nav>
</div>
<article class="doc">
<h1>Reactive Programming</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>At the end of this chapter you will be able to :</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<p><i class="fa fa-check-square-o"></i> Use reactive programming in Quarkus.</p>
</li>
<li>
<p><i class="fa fa-check-square-o"></i> How to use Reactive programming for accessing Rest API services with pagination and back pressure.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quarkusrpb-demo-overview"><a class="anchor" href="#quarkusrpb-demo-overview"></a>Beer Demo Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To demonstrate how to use reactive programming in Quarkus, you will be developing a REST client that connects to a beer database (<a href="https://punkapi.com/documentation/v2" class="bare">https://punkapi.com/documentation/v2</a>) to retrieve beer information.
This API does not return all beers at once, but you need to use pagination to navigate through all beer database.</p>
</div>
<div class="paragraph">
<p>In this section, you are going to develop a service that returns all beers with an <em>abv</em> value greater than <em>7.0</em> and using a reactive approach as a solution.</p>
</div>
<div class="sect2">
<h3 id="quarkusrpb-buld-beer-reactive"><a class="anchor" href="#quarkusrpb-buld-beer-reactive"></a>Build Beer Service</h3>
<div class="paragraph">
<p>The skeleton project to get started is the same you created at <a href="02-basics-fundas.html" class="page">Basics and Fundamentals</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the easier reference, we shall call the <code>fruits-app</code> project folder as $PROJECT_HOME
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="quarkusrpb-add-reactive"><a class="anchor" href="#quarkusrpb-add-reactive"></a>Add Extensions</h4>
<div id="qext-mvn-add-reactive-extensions" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:add-extension -Dextension="quarkus-resteasy-jsonb, quarkus-rest-client, quarkus-smallrye-reactive-streams-operators"</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#qext-mvn-add-reactive-extensions"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="sect3">
<h4 id="quarkusrpb-create-pojo"><a class="anchor" href="#quarkusrpb-create-pojo"></a>Create Beer POJO</h4>
<div class="paragraph">
<p>Let&#8217;s create the <code>Beer</code> pojo.</p>
</div>
<div class="paragraph">
<p>Add new Java file in <code>$PROJECT_HOME/src/main/java/com/example</code> called <code>Beer</code> with the following contents:</p>
</div>
<div id="qext-quarkusrpb-beer-pojo" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

public class Beer {

    private String name;
    private String tagline;
    private double abv;
    private String description;

    // generate getters/setters</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#qext-quarkusrpb-beer-pojo"><i class="fa fa-clipboard"></i></button><br/>
</div>
<div class="sect3">
<h4 id="quarkusrpb-create-beer-client"><a class="anchor" href="#quarkusrpb-create-beer-client"></a>Create Rest Client to Punk Beer API</h4>
<div class="paragraph">
<p>Add new Java file in <code>$PROJECT_HOME/src/main/java/com/example</code> called <code>BeerGateway</code> with the following contents:</p>
</div>
<div id="qext-quarkusrpb-beer-client" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

import java.util.List;
import java.util.concurrent.CompletionStage;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.MediaType;

import org.eclipse.microprofile.rest.client.inject.RegisterRestClient;

@Path("/v2")
@RegisterRestClient
public interface BeerGateway {

    @GET
    @Path("/beers")
    @Produces(MediaType.APPLICATION_JSON)
    CompletionStage&lt;List&lt;Beer&gt;&gt; getBeers(@QueryParam("page") int page); <i class="conum" data-value="1"></i><b>(1)</b>

}</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#qext-quarkusrpb-beer-client"><i class="fa fa-clipboard"></i></button><br/>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Retrieves all beers from a specific page.</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="quarkusrpb-configure-props"><a class="anchor" href="#quarkusrpb-configure-props"></a>Edit the application.properties</h5>
<div class="paragraph">
<p>Add the following properties to $PROJECT_HOME/src/main/resources/application.properties:</p>
</div>
<div id="qext-quarkusrpb-update-props" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-config hljs" data-lang="config">com.example.BeerGateway/mp-rest/url=https://api.punkapi.com</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#qext-quarkusrpb-update-props"><i class="fa fa-clipboard"></i></button><br/>
</div>
</div>
<div class="sect3">
<h4 id="quarkusrpb-beer-reactive-service"><a class="anchor" href="#quarkusrpb-beer-reactive-service"></a>Create Beer Punk API Reactive Service</h4>
<div class="paragraph">
<p>Let&#8217;s create the service that uses <code>BeerGateway</code> to retrieve beer information by page and reactively emits each of the beer information.</p>
</div>
<div class="paragraph">
<p>Add new Java file in <code>$PROJECT_HOME/src/main/java/com/example</code> called <code>BeerService</code> with the following contents:</p>
</div>
<div id="qext-quarkusrpb-beer-service" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

import java.util.List;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;

import javax.enterprise.context.ApplicationScoped;

import org.eclipse.microprofile.rest.client.inject.RestClient;

import io.reactivex.Flowable;


@ApplicationScoped
public class BeerService {

    ExecutorService executor = Executors.newSingleThreadExecutor(); <i class="conum" data-value="1"></i><b>(1)</b>

    @RestClient
    BeerGateway beerGateway;

    public Flowable&lt;Beer&gt; beers() {
        Flowable&lt;List&lt;Beer&gt;&gt; beerStream = Flowable.generate) -&gt; 1, (page, emitter) -&gt; { <i class="conum" data-value="2"></i><b>(2)</b>              beerGateway.getBeers(page).thenAcceptAsync(beers -&gt; {                      if (beers.isEmpty( {
                        emitter.onComplete(); <i class="conum" data-value="3"></i><b>(3)</b>
                    } else {
                        emitter.onNext(beers); <i class="conum" data-value="4"></i><b>(4)</b>
                    }

                }, executor);

                return page + 1; <i class="conum" data-value="5"></i><b>(5)</b>
            });

            return beerStream.flatMap(Flowable::fromIterable); <i class="conum" data-value="6"></i><b>(6)</b>
    }

}</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#qext-quarkusrpb-beer-service"><i class="fa fa-clipboard"></i></button><br/>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>This executor is used to serialize calls and not using multi-threading.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Gets first batch of beers</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sends an event that the process is completed</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Emits each beer</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Gets beers from next page</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Flatten the list of beers event into event of beers</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So far nothing really new, but notice that now instead of reading all the beers, put them in memory and then filter out by any parameter, you are just emitting them individually per page.
The caller is responsible to manipulate this information as it starts receiving the information and it is not necessary to store all beers in memory but just the ones that matches any condition.</p>
</div>
<div class="paragraph">
<p>Notice that until a caller subscribes to a stream (<code>Flowable</code> in this case), the logic is not executed.</p>
</div>
</div>
<div class="sect3">
<h4 id="quarkusrpb-beer-resource"><a class="anchor" href="#quarkusrpb-beer-resource"></a>Create Beer Resource</h4>
<div class="paragraph">
<p>The last step is to manipulate the beer <em>stream</em> created in the previous section to filter out by <em>abv</em> and return the result to the caller.</p>
</div>
<div class="paragraph">
<p>Add new Java file in <code>$PROJECT_HOME/src/main/java/com/example</code> called <code>BeerResource</code> with the following contents:</p>
</div>
<div id="qext-quarkusrpb-beer-resource" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package com.example;

import javax.inject.Inject;
import javax.ws.rs.Consumes;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

import org.reactivestreams.Publisher;

@Path("/beer")
@Consumes(MediaType.APPLICATION_JSON)
@Produces(MediaType.APPLICATION_JSON)
public class BeerResource {

    @Inject
    BeerService beerService; <i class="conum" data-value="1"></i><b>(1)</b>

    @GET
    public Publisher&lt;Beer&gt; hello() {
        return beerService.beers() <i class="conum" data-value="2"></i><b>(2)</b>
                .filter(b -&gt; b.getAbv() &gt; 7.0); <i class="conum" data-value="3"></i><b>(3)</b>
                <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#qext-quarkusrpb-beer-resource"><i class="fa fa-clipboard"></i></button><br/>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Injects <code>BeerService</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Gets the beer stream</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>For each beer emitted checks that <em>abv</em> is greater than 7</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Automatically subscribes to the stream and get back the result as <code>List&lt;Beer&gt;</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The big change here is that now instead of having to deal with all beers in memory and then apply some operations, you are just loading into memory a <em>page</em> of beers, then filter them and finally return them to the caller.</p>
</div>
<div class="paragraph">
<p>Another big advantage is that now the <em>beer servcie</em> is just called if the consumer requests it.
If the operation is canceled/aborted before completion, then you also save IO by not executing the operations.</p>
</div>
<div class="paragraph">
<p>Notice that one of the big advantages of this approach (apart from the memory usage) is that you can apply any reactive operator without modifying the creation of the stream.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="qext-reactive-beer-run-quarkus-app-dev-mode"><a class="anchor" href="#qext-reactive-beer-run-quarkus-app-dev-mode"></a>Run Quarkus Application in Development mode</h3>
<div class="paragraph">
<p>If you are not in dev mode, run the following command to start Quarkus application in development mode:</p>
</div>
<div id="beer-reactive-build-run-dev" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw compile quarkus:dev</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#beer-reactive-build-run-dev-mode"><i class="fa fa-clipboard"></i></button><br/>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If you are in dev mode and you added new dependencies on the project, sometimes, if they are not in the local cache, you might need to stop the dev mode (<span class="keyseq"><kbd>Ctrl</kbd>+<kbd>C</kbd></span>) and start it again.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="qext-call-beer-reactive-service"><a class="anchor" href="#qext-call-beer-reactive-service"></a>Invoke Service</h4>
<div class="paragraph">
<p>The simple <code>beer</code> REST URI can be called via browser using <a href="http://localhost:8080/beer" class="bare">http://localhost:8080/beer</a> or using CLI like:</p>
</div>
<div id="beer-reactive-k8s-svc-call" class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl localhost:8080/beer</code></pre>
</div>
</div>
<button class="copybtn float-right" title="Copy to clipboard" data-clipboard-target="#beer-reactive-k8s-svc-call"><i class="fa fa-clipboard"></i></button><br/>
<div class="paragraph">
<p>The REST call about should return an response like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
   {
      "abv":7.2,
      "description":"An Imperial Pilsner in collaboration with beer writers...." ,
      "name":"Avery Brown Dredge",
      "tagline":"Bloggers' Imperial Pilsner."
   },
   ...
]</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
        <ul class="rhd-menu">
          <li class="menu-item menu-item--expanded">
            <h3 class="section-toggle">GitHub</h3>
            <ul class="rhd-menu">
              <li class="menu-item">
                <a href="https://github.com/redhat-developer-demos/quarkus-tutorial" title="Quarkus Tutorial">Quarkus
                  Tutorial</a>
              </li>
              <li class="menu-item">
                <a href="https://github.com/redhat-developer-demos/quarkus-tutorial/issues" title="Issue Tracker">Issue
                  Tracker</a>
              </li>
              <li class="menu-item">
                <a href="https://quarkus.io" title="Quarkus">Quarkus</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <div class="rhd-footer-sidebar">
        <p class="rhd-footer-sidebar-title">Red Hat Developer</p>
        <p class="rhd-footer-sidebar-subtitle">Build here. Go anywhere.</p>
        <p class="rhd-footer-sidebar-content">
          We serve the builders. The problem solvers who create careers with
          code.<br /><br /><a href="https://developer.redhat.com/register">Join us</a>
          if you’re a developer, software engineer, web designer, front-end
          designer, UX designer, computer scientist, architect, tester,
          product manager, project manager or team lead.
        </p>
        <ul class="rhd-footer-sidebar-social">
          <li>
            <a href="https://www.youtube.com/channel/UC7noUdfWp-ukXUlAsJnSm-Q" target="_blank"
              rel="noopener noreferrer"><svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                data-prefix="fab" data-icon="youtube" role="img" xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 576 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                </path>
              </svg><!-- <i class="fab fa-youtube"></i> --></a>
          </li>
          <li>
            <a href="https://www.facebook.com/RedHatDeveloperProgram" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-facebook fa-w-14" aria-hidden="true" data-prefix="fab" data-icon="facebook"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M448 56.7v398.5c0 13.7-11.1 24.7-24.7 24.7H309.1V306.5h58.2l8.7-67.6h-67v-43.2c0-19.6 5.4-32.9 33.5-32.9h35.8v-60.5c-6.2-.8-27.4-2.7-52.2-2.7-51.6 0-87 31.5-87 89.4v49.9h-58.4v67.6h58.4V480H24.7C11.1 480 0 468.9 0 455.3V56.7C0 43.1 11.1 32 24.7 32h398.5c13.7 0 24.8 11.1 24.8 24.7z">
                </path>
              </svg><!-- <i class="fab fa-facebook"> </i> --></a>
          </li>
          <li>
            <a href="https://twitter.com/rhdevelopers" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="twitter"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z">
                </path>
              </svg><!-- <i class="fab fa-twitter"> </i> --></a>
          </li>
          <li>
            <a href="https://github.com/redhat-developer" target="_blank" rel="noopener noreferrer"><svg
                class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" data-prefix="fab" data-icon="github"
                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg="">
                <path fill="currentColor"
                  d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z">
                </path>
              </svg><!-- <i class="fab fa-github"> </i> --></a>
          </li>
        </ul>
        <a class="rhd-footer-sidebar-signup" href="https://developers.redhat.com/register">Sign me up ▸</a>
      </div>
    </div>
  </div>
</footer><script src="../../_/js/site.js"></script>
<script src="../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
